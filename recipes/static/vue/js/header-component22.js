"use strict";(self["webpackChunkvue"]=self["webpackChunkvue"]||[]).push([[77],{98682:function(e,t,i){i.r(t);var s=i(99930),n=i(46475),a=(i(80110),i(1001)),r=(0,a.Z)(n.Z,s.s,s.x,!1,null,null,null);t["default"]=r.exports},80110:function(e,t,i){i(62504)},46475:function(e,t,i){var s=i(17917);t["Z"]=s.Z},99930:function(e,t,i){i.d(t,{s:function(){return s},x:function(){return n}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.recipes!=={}?i("div",[i("div",{staticClass:"align-center",attrs:{id:"switcher"}},[i("i",{directives:[{name:"b-toggle",rawName:"v-b-toggle.related-recipes",modifiers:{"related-recipes":!0}}],staticClass:"btn btn-primary fas fa-receipt fa-xl fa-fw shadow-none btn-circle"})]),i("b-sidebar",{staticStyle:{"z-index":"10000"},attrs:{id:"related-recipes",backdrop:"",right:"",bottom:"","no-header":"",shadow:"sm"},on:{shown:function(t){return e.updatePinnedRecipes()}},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.hide;return[i("div",{staticClass:"d-flex flex-column justify-content-end h-100 p-3 align-items-end"},[i("h5",[e._v(e._s(e.$t("Planned"))+" "),i("i",{staticClass:"fas fa-calendar fa-fw"})]),i("div",{staticClass:"text-right"},[e.planned_recipes.length>0?e._l(e.planned_recipes,(function(t){return i("div",{key:"plan"+t.id},[i("div",{staticClass:"pb-1 pt-1"},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(i){e.navRecipe(t),s()}}},[e._v(e._s(t.name))])])])})):[i("span",{staticClass:"text-muted"},[e._v(e._s(e.$t("nothing_planned_today")))])]],2),i("h5",[e._v(e._s(e.$t("Pinned"))+" "),i("i",{staticClass:"fas fa-thumbtack fa-fw"})]),e.pinned_recipes.length>0?[i("div",{staticClass:"text-right"},e._l(e.pinned_recipes,(function(t){return i("div",{key:"pin"+t.id},[i("b-row",{staticClass:"pb-1 pt-1"},[i("b-col",{attrs:{cols:"2"}},[i("a",{staticClass:"text-muted",attrs:{href:"javascript:void(0)"},on:{click:function(i){return e.unPinRecipe(t)}}},[i("i",{staticClass:"fas fa-times"})])]),i("b-col",{attrs:{cols:"10"}},[i("a",{staticClass:"align-self-end",attrs:{href:"javascript:void(0);"},on:{click:function(i){e.navRecipe(t),s()}}},[e._v(e._s(t.name)+" ")])])],1)],1)})),0)]:[i("span",{staticClass:"text-muted"},[e._v(e._s(e.$t("no_pinned_recipes")))])],e.related_recipes.length>0?[i("h5",[e._v("Related "),i("i",{staticClass:"fas fa-link fa-fw"})]),i("div",{staticClass:"text-right"},e._l(e.related_recipes,(function(t){return i("div",{key:"related"+t.id},[i("div",{staticClass:"pb-1 pt-1"},[i("a",{attrs:{href:"javascript:void(0);"},on:{click:function(i){e.navRecipe(t),s()}}},[e._v(e._s(t.name))])])])})),0)]:e._e()],2)]}},{key:"footer",fn:function(t){var s=t.hide;return[i("div",{staticClass:"d-flex bg-dark text-light align-items-center px-3 py-2"},[i("strong",{staticClass:"mr-auto"},[e._v(e._s(e.$t("Quick actions")))]),i("b-button",{attrs:{size:"sm"},on:{click:s}},[e._v(e._s(e.$t("Close")))])],1)]}}],null,!1,1200845374)})],1):e._e()},n=[]},62504:function(){},17917:function(e,t,i){i(26699);var s=i(4222);const{ApiApiFactory:n}=i(70846);t["Z"]={name:"RecipeSwitcher",mixins:[s.ResolveUrlMixin],props:{recipe:{type:Number,default:void 0}},data(){return{related_recipes:[],planned_recipes:[],pinned_recipes:[],recipes:{}}},computed:{is_recipe_view:function(){return this.$root._vnode.tag.includes("RecipeView")}},mounted(){let e=[];e.push(this.loadRelatedRecipes()),this.loadPinnedRecipes(),e.push(this.loadMealPlans()),Promise.all(e).then((()=>{this.loadRecipeData()}))},methods:{navRecipe:function(e){this.is_recipe_view?this.$emit("switch",this.recipes[e.id]):window.location.href=this.resolveDjangoUrl("view_recipe",e.id)},updatePinnedRecipes:function(){this.loadPinnedRecipes(),this.loadRecipeData()},loadRecipeData:function(){let e=new n,t=[...this.related_recipes,...this.planned_recipes,...this.pinned_recipes],i=[];t.forEach((e=>{let t=e.id;i.includes(t)||i.push(t)})),i.forEach((t=>{e.retrieveRecipe(t).then((e=>{this.recipes[t]=e.data}))}))},loadRelatedRecipes:function(){let e=new n;if(this.$parent.recipe)return this.related_recipes=[this.$parent.recipe],e.relatedRecipe(this.$parent.recipe.id,{query:{levels:2,format:"json"}}).then((e=>{this.related_recipes=this.related_recipes.concat(e.data)}))},loadPinnedRecipes:function(){let e=JSON.parse(localStorage.getItem("pinned_recipes"))||[];this.pinned_recipes=e},loadMealPlans:function(){let e=new n;var t=6e4*(new Date).getTimezoneOffset();let i=new Date(Date.now()-t).toISOString().split("T")[0];return e.listMealPlans({query:{from_date:i,to_date:i}}).then((t=>{let i=[];return t.data.forEach((t=>{this.planned_recipes.push({...t?.recipe,servings:t?.servings});const s=(t?.servings??t?.recipe?.servings??1)/(t?.recipe?.servings??1);i.push(e.relatedRecipe(t?.recipe?.id,{query:{levels:2}}).then((e=>{e.data=e.data.map((e=>({...e,factor:s}))),this.planned_recipes=[...this.planned_recipes,...e.data]})))})),Promise.all(i)}))},unPinRecipe:function(e){let t=JSON.parse(localStorage.getItem("pinned_recipes"))||[];t=t.filter((t=>t.id!==e.id)),console.log("pinned left",t),this.pinned_recipes=t,localStorage.setItem("pinned_recipes",JSON.stringify(t))}}}}}]);